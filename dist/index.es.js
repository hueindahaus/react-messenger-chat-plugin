import e,{useEffect as t}from"react";import o from"prop-types";let n=!1,s=!1;const r=({pageId:o,language:r="en_US",themeColor:g,height:a,autoExpand:c=!0,loggedInGreeting:l,loggedOutGreeting:u,ref:h,onMessengerMounted:d,onMessengerLoad:m,onMessengerShow:b,onMessengerHide:p,onMessengerDialogShow:w,onMessengerDialogHide:f,debugMode:y=!1,version:C="v11.0"})=>{const E=()=>{y&&console.log("[react-messenger-chat-plugin] expanding on init");try{const e=JSON.parse(localStorage.getItem("__fb_chat_plugin")),t="navigate"!==performance?.getEntriesByType("navigation")[0]?.type;e&&"hidden"===e?.visibility&&!t&&FB.CustomerChat.show()}catch(e){throw console.warn("Probblem when autoexpanding messenger chatbox occured. Please file an issue on github."),new Error(e)}};return t((()=>{try{s=y,(()=>{y&&console.log("[react-messenger-chat-plugin] initializing messenger plugin");try{const e=document.getElementById("fb-customer-chat");e.setAttribute("page_id",o),e.setAttribute("attribution","biz_inbox"),g&&e.setAttribute("theme_color",g),l&&e.setAttribute("logged_in_greeting",l),u&&e.setAttribute("logged_out_greeting",u),c?(e.setAttribute("greeting_dialog_display","show"),e.setAttribute("greeting_dialog_delay",0)):e.setAttribute("greeting_dialog_display","hide"),h&&e.setAttribute("ref",h),window.fbAsyncInit=function(){FB.init({xfbml:!0,version:C}),FB.Event.subscribe("customerchat.load",(()=>{m&&m()})),FB.Event.subscribe("xfbml.render",(()=>{void 0!==a&&i(a),c&&setTimeout(E,3e3),d&&d(),n=!0})),FB.Event.subscribe("customerchat.show",(()=>{b&&b()})),FB.Event.subscribe("customerchat.hide",(()=>{p&&p()})),FB.Event.subscribe("customerchat.dialogShow",(()=>{w&&w()})),FB.Event.subscribe("customerchat.dialogHide",(()=>{f&&f()}))},function(e,t,o){let n,s=e.getElementsByTagName(t)[0];e.getElementById(o)||(n=e.createElement(t),n.id=o,n.src=`https://connect.facebook.net/${r}/sdk/xfbml.customerchat.js`,s.parentNode.insertBefore(n,s))}(document,"script","facebook-jssdk")}catch(e){throw e}})()}catch(e){console.log(e)}})),e.createElement("div",null,e.createElement("div",{id:"fb-root"}),e.createElement("div",{id:"fb-customer-chat",className:"fb-customerchat"}))},i=e=>{s&&console.log(`[react-messenger-chat-plugin] setting messenger height: ${e}`);const t=document.querySelectorAll("[data-testid='bubble_iframe']");if(t&&t.length>0){t[0].style.bottom=`${e}px`}else console.warn("Could not set height of messenger button.");const o=document.querySelectorAll("[data-testid='dialog_iframe']");if(t&&o.length>0){o[0].style.bottom=`${e+56}px`}else console.warn("Could not set height of messenger dialog container.")},g=e=>{s&&console.log(`[react-messenger-chat-plugin] showing messenger with argument "shouldShowDialog": ${e}`);try{n&&FB?.CustomerChat?FB.CustomerChat.show(e):n||console.warn("Messenger could not expand messenger due to the messenger chat not beeing mounted yet.")}catch(e){throw new Error(e)}},a=(e=!1)=>{s&&console.log("[react-messenger-chat-plugin] hiding messenger with argument");try{n&&FB?.CustomerChat?FB.CustomerChat.hide():n||console.warn("Messenger could not hide messenger due to the messenger chat not beeing mounted yet.")}catch(e){throw new Error(e)}},c=()=>{s&&console.log("[react-messenger-chat-plugin] showing dialog");try{n&&FB?.CustomerChat?FB.CustomerChat.showDialog():n||console.warn("Messenger could not show dialog due to the messenger chat not beeing mounted yet.")}catch(e){throw new Error(e)}},l=()=>{s&&console.log("[react-messenger-chat-plugin] hiding dialog");try{n&&FB?.CustomerChat?FB.CustomerChat.hideDialog():n||console.warn("Messenger could not hide dialog due to the messenger chat not beeing mounted yet.")}catch(e){throw new Error(e)}};r.propTypes={pageId:o.string.isRequired,language:o.string,themeColor:o.string,height:o.number,autoExpand:o.bool,loggedInGreeting:o.string,loggedOutGreeting:o.string,ref:o.string,onMessengerMounted:o.func,onMessengerLoad:o.func,onMessengerShow:o.func,onMessengerHide:o.func,onMessengerDialogShow:o.func,onMessengerDialogHide:o.func,debugMode:o.bool,version:o.string,custom:function(e){e.debugMode&&console.log(e);const t=e.themeColor;if(t&&!/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t))return new Error("Invalid hexcolor format on prop: themeColor")}};export{r as MessengerChat,l as hideDialog,a as hideMessenger,i as setMessengerHeight,c as showDialog,g as showMessenger};
